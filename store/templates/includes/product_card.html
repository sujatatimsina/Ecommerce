{% comment %}
This template renders a single product card.
It expects a 'product' object in its context.
Enhanced version with better responsiveness, hover effects, and modern styling.
{% endcomment %}

{% load static %}
{% load product_images %}

<div class="col-6 col-md-4 col-lg-3 col-xl-2 mb-4">
    <div class="card product-card h-100 shadow-sm border-0 rounded-3 overflow-hidden transition-all">
        
        <!-- Sale Badge with better positioning -->
        {% if product.is_sale %}
        <div class="sale-badge position-absolute bg-danger text-white py-1 px-2 rounded-end z-1" 
             style="top: 1rem; left: 0; font-size: 0.75rem; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            SALE
        </div>
        {% endif %}

        <!-- Product Image with hover effect -->
         
        <div class="product-image-container position-relative overflow-hidden" style="height: 200px;">
            <img class="card-img-top h-100 w-100 object-fit-cover transition-transform" 
                 src="{% static product.name|get_product_image %}" 
                 alt="{{ product.name }}"
                 loading="lazy" />
            <div class="image-overlay position-absolute top-0 start-0 w-100 h-100 bg-dark opacity-0 transition-opacity"></div>
        </div>
        
        <!-- Product Body -->
        <div class="card-body p-3 d-flex flex-column">
            <!-- Product Name with ellipsis for overflow -->
            <h5 class="fw-semibold mb-2 text-truncate" title="{{ product.name }}">
                {{ product.name }}
            </h5>
            
            <!-- Product Price -->
            <div class="product-price mt-auto">
                {% if product.is_sale %}
                <div class="d-flex align-items-center justify-content-center flex-wrap gap-2">
                    <span class="text-muted text-decoration-line-through small">Rs{{ product.price }}</span>
                    <span class="fs-5 fw-bold text-danger">Rs{{ product.sale_price }}</span>
                    <span class="badge bg-danger bg-opacity-10 text-danger small">
                        Save Rs{{ product.price|add:"-"|add:product.sale_price }}
                    </span>
                </div>
                {% else %}
                <div class="text-center">
                    <span class="fs-5 fw-bold text-dark">Rs{{ product.price }}</span>
                </div>
                {% endif %}
            </div>

            <!-- Rating Section (Optional - Add if your product model has ratings) -->
            {% comment %}
            {% if product.rating %}
            <div class="product-rating d-flex justify-content-center align-items-center mt-2">
                <div class="text-warning small">
                    {% for i in "12345"|make_list %}
                        {% if forloop.counter <= product.rating %}
                            ★
                        {% else %}
                            ☆
                        {% endif %}
                    {% endfor %}
                </div>
                <small class="text-muted ms-1">({{ product.review_count }})</small>
            </div>
            {% endif %}
            {% endcomment %}
        </div>

        <!-- Card Footer -->
        <div class="card-footer p-3 pt-0 border-top-0 bg-transparent">
            <div class="d-grid gap-2">
                <a class="btn btn-dark btn-sm fw-semibold py-2 transition-all" 
                   href="{% url 'product' product.id %}"
                   aria-label="View {{ product.name }}">
                    View Product
                </a>
                <!-- Optional: Add to cart button -->
                {% comment %}
                <button class="btn btn-outline-dark btn-sm py-2 add-to-cart" 
                        data-product-id="{{ product.id }}"
                        aria-label="Add {{ product.name }} to cart">
                    <i class="bi bi-cart-plus me-1"></i> Add to Cart
                </button>
                {% endcomment %}
            </div>
        </div>
    </div>
</div>

<style>
    .product-card {
        transition: all 0.3s ease;
        min-height: 380px;
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
    
    .product-image-container:hover .card-img-top {
        transform: scale(1.05);
    }
    
    .product-image-container:hover .image-overlay {
        opacity: 0.1;
    }
    
    .transition-all {
        transition: all 0.3s ease;
    }
    
    .transition-transform {
        transition: transform 0.5s ease;
    }
    
    .transition-opacity {
        transition: opacity 0.3s ease;
    }
    
    .object-fit-cover {
        object-fit: cover;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .col-6 {
            padding-left: 4px;
            padding-right: 4px;
        }
        
        .product-card {
            min-height: 340px;
        }
        
        .product-image-container {
            height: 160px;
        }
        
        .card-body h5 {
            font-size: 0.9rem;
        }
        
        .btn-sm {
            font-size: 0.8rem;
            padding: 0.4rem 0.75rem;
        }
    }
    
    @media (max-width: 576px) {
        .product-image-container {
            height: 140px;
        }
        
        .product-card {
            min-height: 320px;
        }
        
        .card-body {
            padding: 0.75rem !important;
        }
        
        .card-footer {
            padding: 0.75rem !important;
        }
    }
    
    @media (max-width: 400px) {
        .col-6 {
            flex: 0 0 50%;
            max-width: 50%;
        }
    }
</style>